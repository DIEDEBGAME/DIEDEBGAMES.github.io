<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>S√≥tano del Terror 3D - DIEDEB GAMES</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: black; }
        #ui { position: fixed; top: 15px; left: 15px; color: white; z-index: 100; font-family: 'Courier New', monospace; background: rgba(0,0,0,0.8); padding: 15px; border: 2px solid red; pointer-events: none; }
        #hand { position: fixed; bottom: 30px; right: 80px; font-size: 100px; z-index: 200; pointer-events: none; }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 8px; height: 8px; background: red; border-radius: 50%; transform: translate(-50%, -50%); z-index: 150; pointer-events: none; }
        #warning { position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%); color: red; font-size: 50px; font-weight: bold; display: none; z-index: 300; text-align: center; text-shadow: 0 0 30px black; }
        #click-to-start { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; color: white; display: flex; justify-content: center; align-items: center; z-index: 1000; cursor: pointer; font-family: 'Courier New', monospace; }
        #noche-ui { color: #ff00ff; font-size: 20px; font-weight: bold; margin-top: 10px; border-top: 1px solid #444; padding-top: 5px; }
    </style>
</head>
<body>

    <div id="click-to-start">
        <h1 style="border: 4px solid red; padding: 20px;">CLICK PARA EMPEZAR LA NOCHE</h1>
    </div>

    <div id="ui">
        <div id="timer" style="color:#0f0; font-size:24px;">TIEMPO TOTAL: 0s</div>
        <div id="danger-text" style="color: yellow;">ESTADO: SEGURO</div>
        <div id="noche-ui">NOCHE: 1 | FIN EN: 1:30</div>
    </div>

    <div id="warning">‚ö†Ô∏è ¬°PELIGRO! ‚ö†Ô∏è<br><span id="countdown" style="font-size: 120px;">9</span></div>
    <div id="hand"></div>
    <div id="crosshair"></div>

    <a-scene id="scene">
        <a-sky color="#010101"></a-sky>
        <a-plane position="0 0 -10" rotation="-90 0 0" width="10" height="60" color="#0a0a0a"></a-plane>
        <a-plane position="-5 2.5 -10" rotation="0 90 0" width="60" height="6" color="#111"></a-plane> 
        <a-plane position="5 2.5 -10" rotation="0 -90 0" width="60" height="6" color="#111"></a-plane>

        <a-entity position="-5 0 -5">
            <a-plane position="-4 2.5 0" rotation="0 90 0" width="6" height="5" color="#020202"></a-plane>
            <a-text value="üßü" position="-7 1.5 0" rotation="0 90 0" scale="15 15 15"></a-text>
            <a-text value="HABITACION ZOMBI" position="0.1 3.2 0" rotation="0 90 0" align="center" color="#00ff00" width="12"></a-text>
        </a-entity>

        <a-entity position="5 0 -12">
            <a-plane position="4 2.5 0" rotation="0 -90 0" width="6" height="5" color="#020202"></a-plane>
            <a-text value="üï∑Ô∏è" position="7 1.5 0" rotation="0 -90 0" scale="15 15 15"></a-text>
            <a-text value="HABITACION ARA√ëA" position="-0.1 3.2 0" rotation="0 -90 0" align="center" color="#a349a4" width="12"></a-text>
        </a-entity>

        <a-entity position="-5 0 -20">
            <a-plane position="-4 2.5 0" rotation="0 90 0" width="6" height="5" color="#1a0000"></a-plane>
            <a-text value="ü¶ñ" position="-7 2 0" rotation="0 90 0" scale="25 25 25"></a-text>
            <a-text value="HABITACION DINO" position="0.1 3.2 0" rotation="0 90 0" align="center" color="#ff0000" width="12"></a-text>
        </a-entity>

        <a-entity position="0 0 -35">
            <a-text value="S√ìTANO" position="0 4 0" align="center" scale="3 3 3" color="red"></a-text>
            <a-box position="-2.5 0.5 0" color="white" onclick="pick('ü¶¥', 'Huesos')"><a-text value="HUESOS" align="center" position="0 0.8 0"></a-text></a-box>
            <a-box position="2.5 0.5 0" color="red" onclick="pick('ü©∏', 'Kapsut')"><a-text value="KAPSUT" align="center" position="0 0.8 0"></a-text></a-box>
            <a-box position="-2.5 0.5 3" color="green" onclick="pick('üí®', 'Repelente')"><a-text value="REPELENTE" align="center" position="0 0.8 0"></a-text></a-box>
            <a-box position="2.5 0.5 3" color="orange" onclick="pick('üçñ', 'Hueso Gigante')"><a-text value="GIGANTE" align="center" position="0 0.8 0"></a-text></a-box>
        </a-entity>

        <a-entity id="player" camera look-controls="pointerLockEnabled: true" wasd-controls="acceleration: 70" position="0 1.6 0">
            <a-cursor visible="false"></a-cursor>
        </a-entity>
    </a-scene>

    <script>
        let inventory = "Nada";
        let time = 0;
        let danger = "";
        let countdown = 9;
        let timerId = null;
        let nocheActual = 1;
        let cronoNoche = 90;

        const startScreen = document.getElementById('click-to-start');
        startScreen.addEventListener('click', () => {
            startScreen.style.display = 'none';
            document.querySelector('a-scene').canvas.requestPointerLock();
        });

        function pick(emoji, name) {
            inventory = name;
            document.getElementById('hand').innerText = emoji;
        }

        setInterval(() => {
            time++;
            document.getElementById('timer').innerText = "TIEMPO TOTAL: " + time + "s";
            cronoNoche--;
            let m = Math.floor(cronoNoche / 60);
            let s = cronoNoche % 60;
            document.getElementById('noche-ui').innerText = `NOCHE: ${nocheActual} | FIN EN: ${m}:${s < 10 ? '0' : ''}${s}`;

            if (cronoNoche <= 0) {
                nocheActual++;
                cronoNoche = 90;
                alert("¬°SOBREVIVISTE A LA NOCHE! Entrando a la Noche " + nocheActual);
            }

            if (time > 2 && time % 25 === 0 && danger === "") {
                const list = ["Dino", "Ara√±a", "Zombi"];
                danger = list[Math.floor(Math.random() * list.length)];
                startDanger();
            }
            checkPosition();
        }, 1000);

        function startDanger() {
            countdown = 9;
            document.getElementById('warning').style.display = 'block';
            document.getElementById('danger-text').innerText = "¬°ATAQUE DE " + danger.toUpperCase() + "!";
            timerId = setInterval(() => {
                countdown--;
                document.getElementById('countdown').innerText = countdown;
                if(countdown <= 0) {
                    alert("GAME OVER: El " + danger + " te mat√≥.");
                    location.reload();
                }
            }, 1000);
        }

        function checkPosition() {
            const p = document.getElementById('player').getAttribute('position');
            if (danger === "Zombi" && p.x < -4 && p.z < -2 && p.z > -8 && inventory === "Huesos") solve();
            if (danger === "Ara√±a" && p.x > 4 && p.z < -9 && p.z > -15 && inventory === "Repelente") solve();
            if (danger === "Dino" && p.x < -4 && p.z < -17 && p.z > -23 && inventory === "Hueso Gigante") solve();
        }

        function solve() {
            clearInterval(timerId);
            danger = "";
            inventory = "Nada";
            document.getElementById('hand').innerText = "";
            document.getElementById('warning').style.display = 'none';
            document.getElementById('danger-text').innerText = "ESTADO: SEGURO";
            alert("¬°Monstruo calmado!");
        }
    </script>
</body>
</html>